<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JMW | Tabs</title>
  <script async defer src="./js/tabs.js" type="module"></script>
  <link href="/assets/css/tabs.css" rel="stylesheet" />
  <script type="module" async defer>
    import {
      setWisp,
			setProxy,
      makeURL,
      getProxied,
      setFrames,
      addressInput,
      currentTab,
      Tab
    } from "/cat.mjs"

    // --- INIT ---
    const form = document.getElementById("form")
    let search =
      localStorage.getItem("search-engine") ||
      "https://search.brave.com/search?q=%s"

    async function autofill(url) {
      const urlToLoad = makeURL(url, search)
      const proxiedUrl = await getProxied(urlToLoad)
      setTimeout(() => {

        document.getElementById(`frame-${currentTab}`).src = proxiedUrl;
      }, 200);
    }

try {
    const params = new URLSearchParams(window.location.search);
    const autofillUrl = params.get('autofill');
    if (autofillUrl) {
      autofill(autofillUrl);
    }
		}catch{}


    //
    // setWisp((location.protocol === "https:" ? "wss://" : "ws://") +
    //  location.host +
    //  "/wisp/")
     setWisp("wss://anura.pro/");

//setProxy(localStorage.getItem("pr0xy") || "scram")

     setWisp((location.protocol === "https:" ? "wss://" : "ws://") + location.host + "/wisp/");


    // --- EVENTS ---
    form?.addEventListener("submit", async (event) => {
      event.preventDefault()

      const urlToLoad = makeURL(addressInput.value, search)
      const proxiedUrl = await getProxied(urlToLoad)

      let currentFrame = document.getElementById(`frame-${currentTab}`);

      currentFrame.src = proxiedUrl

      if (currentFrame === document.getElementById(`frame-${currentTab}`)) {
        addressInput.value = urlToLoad

        if (urlToLoad == "newtab.html") {
          addressInput.value = "jmw://newtab"
        }

      }
    })



    setFrames(document.getElementById("frames"));
    new Tab();
  </script>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
</head>

<body theme="classic">
      <div id="customAlert" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:900px;height:300px;overflow-y:auto;background:black;color:var(--txtcolor);padding:30px;box-shadow:0 0 30px rgba(0,0,0,0.6);z-index:999999999999999999999999999;border-radius:16px;">
  <button id="alertClose" style="position:absolute;top:15px;right:15px;background:transparent;background-color:transparent;border:none;font-size:22px;cursor:pointer;">✕</button>
  <div id="alertContent" style="overflow-y:auto;max-height:520px;">
    <center>
      <br>
      <br>
      <h1 style="font-size:16px;margin-bottom:10px;">⚠️ READ BEFORE YOU USE THIS, REMEMBER THIS⚠️</h1>
      <h2 style="font-size:14px;margin-bottom:8px;">⚠️Warning: This prσxy is very buggy and is enabled by scramjet. PLEASE DO THIS BEFORE ACCESSING THE UNBL0CKER.⚠️</h2>
      <h2 style="font-size:14px;margin-bottom:8px;">Here are some fixes to errors you might encounter.</h2>
      <h3 style="font-size:13px;margin-bottom:6px;">"Cannot GET error or 'Uh Oh!' Screen."</h3>
      <p style="font-size:12px;margin-bottom:6px;">Easy Fix (USE METHOD 1 FIRST):</p>
      <ul style="font-size:12px;list-style:disc;padding-left:20px;text-align:left;">
        <li>Method 1: Click the button <button style="color:white" onclick="registerSW()" style="font-size:13px;">Right Here</button> to register the SW</li>
        <p>IF THAT DOESN'T WORK:</p>
        <li>Method 2: Clear your cookies, copy the url over <span onclick="copy();" style="text-decoration: underline;cursor:pointer;color:white;">HERE</span> or go to chrome://settings/content/all?searchSubpage=(jmw link here), press the trashcan icon next to the link, then repeat the first method.</li>
        <p>IF THAT DOESN'T WORK:</p>
        <li>Method 3: press CTRL-SHIFT-R</li>
        <p>IF THAT DOESN'T WORK:</p>
        <li>Method 4: Go over <a href="/active/index.html?autofill=doyouseethisifyoudoitworks" target="blank" style="color:white;">Here (click here)</a>, if it doesn't work go <a href="/active/index.html?autofill=doyouseethisifyoudoitworks" target="blank" style="color:white;">Here (click here)</a> again and search something random.</li>
      </ul>
      <h4>Join <a style="color:white;" href="//dsc.gg/gnetwork">Our Discord Server</a> If you have any trouble (discord.gg/gSjNsVxX5y)</h4>
    </center>
  </div>
  <button id="alertHide" style="display:block;margin:20px auto 0 auto;padding:10px 20px;border:none;background:#333;color:#fff;border-radius:10px;cursor:pointer;">Do not show again</button>
</div>

  <nav>
    <div id="tabs"></div>
    <button id="new-tab-btn" aria-label="New Tab" title="New Tab">

      <i class='bx bx-plus'></i>
    </button>
  </nav>

  <form id="form" align="center">
    <a href="#" id="fullscreen-icon" class="fc nav-btn" onclick="historyBack();"><i class='bx bx-chevron-left'></i></a>
    <a href="#" id="fullscreen-icon" class="fc nav-btn" onclick="historyForward();"><i class='bx bx-chevron-right'></i></a>
    <a href="#" id="fullscreen-icon" class="fc nav-btn" onclick="reload();"><i class="bx bx-refresh"></i></a>
    <input id="address" type="text" placeholder="Search privately.." class="search" autocomplete="off" />
    <a href="#" id="fullscreen-icon" class="fc" onclick="full();"><i class="bx bx-fullscreen"></i></a>
  </form>
  <section id="frames"></section>
  <script async defer>
function full() {
  const activeFrame = document.querySelector('iframe[id^="frame-"]:not(.hidden)');
  if (!activeFrame) return;
  if (!document.fullscreenElement) {
    activeFrame.requestFullscreen().catch(err => {
      alert(`Error attempting to enable fullscreen mode: ${err.message} (${err.name})`);
    });
  } else {
    document.exitFullscreen();
  }
}
  </script>
</body>
<script src="/assets/scripts/index.js"></script>
<script>
function reload() {
  var iframe = document.querySelector("iframe");
  iframe.contentWindow.location.reload();
}
function historyBack() {
  var iframe = document.querySelector("iframe");
  iframe.contentWindow.history.back();
}
function historyForward() {
  var iframe = document.querySelector("iframe");
  iframe.contentWindow.history.forward();
}
</script>
  <script>
(function(){
  if(localStorage.getItem("hideCustomAlert")==="true") return
  var alertBox=document.getElementById("customAlert")
  var closeBtn=document.getElementById("alertClose")
  var hideBtn=document.getElementById("alertHide")
  alertBox.style.display="block"
  closeBtn.addEventListener("click",function(){alertBox.style.display="none"})
  hideBtn.addEventListener("click",function(){
    localStorage.setItem("hideCustomAlert","true")
    alertBox.style.display="none"
  })
})();
</script>

<script>
function copy() {
  const url = window.location.origin;
  const text = "chrome://settings/content/all?searchSubpage=" + url;
  navigator.clipboard.writeText(text).then(() => {
    alert(text + " is now in your clipboard. Please paste the URL in the search bar in a new tab.");
  });
}
</script>
<script>
  const paramss = new URLSearchParams(window.location.search);
  if (paramss.has("goback")) {
    setTimeout(() => {
      window.location.replace("/");
    }, 10000);
  }
</script>
<script>
if (paramss.has("autofill")) {
    const overlay = document.createElement("div");
    Object.assign(overlay.style, {
        position: "fixed",
        top: 0,
        left: 0,
        width: "100%",
        height: "100%",
        background: "rgba(0,0,0,0.7)",
        color: "#fff",
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
        fontSize: "24px",
        zIndex: "99999999999999999"
    });
    overlay.textContent = "Loading... please wait";
    document.body.appendChild(overlay);

    setTimeout(() => {
        overlay.remove();
    }, 7000);
}
</script>
</html>
