<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JMW | Tabs</title>
  <script async defer src="./js/tabs.js" type="module"></script>
  <link href="/assets/css/tabs.css" rel="stylesheet" />
  <script type="module" async defer>
    import {
      setWisp,
      makeURL,
      getProxied,
      setFrames,
      addressInput,
      currentTab,
      Tab
    } from "/cat.mjs"

    // --- INIT ---
    const form = document.getElementById("form")
    let search =
      localStorage.getItem("search-engine") ||
      "https://search.brave.com/search?q=%s"

    async function autofill(url) {
      const urlToLoad = makeURL(url, search)
      const proxiedUrl = await getProxied(urlToLoad)
      setTimeout(() => {

        document.getElementById(`frame-${currentTab}`).src = proxiedUrl;
      }, 200);
    }

    const params = new URLSearchParams(window.location.search);
    const autofillUrl = params.get('autofill');
    if (autofillUrl) {
      autofill(autofillUrl);
    }


    //
    // setWisp((location.protocol === "https:" ? "wss://" : "ws://") +
    //  location.host +
    //  "/wisp/")
    // setWisp("wss://anura.pro/");

      setWisp((location.protocol === "https:" ? "wss://" : "ws://") + location.host + "/wisp/");


    // --- EVENTS ---
    form?.addEventListener("submit", async (event) => {
      event.preventDefault()

      const urlToLoad = makeURL(addressInput.value, search)
      const proxiedUrl = await getProxied(urlToLoad)

      let currentFrame = document.getElementById(`frame-${currentTab}`);

      currentFrame.src = proxiedUrl

      if (currentFrame === document.getElementById(`frame-${currentTab}`)) {
        addressInput.value = urlToLoad

        if (urlToLoad == "newtab.html") {
          addressInput.value = "jmw://newtab"
        }

      }
    })



    setFrames(document.getElementById("frames"));
    new Tab();
  </script>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
</head>

<body theme="classic">
      <div id="customAlert" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:900px;height:300px;overflow-y:auto;background:black;color:var(--txtcolor);padding:30px;box-shadow:0 0 30px rgba(0,0,0,0.6);z-index:999999999999999999999999999;border-radius:16px;">
  <button id="alertClose" style="position:absolute;top:15px;right:15px;background:none;border:none;font-size:22px;cursor:pointer;">✕</button>
  <div id="alertContent" style="overflow-y:auto;max-height:520px;">
    <center>
      <h1 style="font-size:16px;margin-bottom:10px;">⚠️Warning: This proxy is very buggy and is enabled by scramjet. PLEASE DO THIS BEFORE ACCESSING THE PROXY.⚠️</h1>
      <h2 style="font-size:14px;margin-bottom:8px;">Here are some fixes to errors you might encounter.</h2>
      <h3 style="font-size:13px;margin-bottom:6px;">"Cannot GET error or 'Uh Oh!' Screen."</h3>
      <h3 style="font-size:13px;margin-bottom:6px;">if you did this press do not show again.</h3>
      <p style="font-size:12px;margin-bottom:6px;">Easy Fix (USE 1ST METHOD FIRST):</p>
      <ul style="font-size:12px;list-style:disc;padding-left:20px;text-align:left;">
        <li>1st method: Click the link <a href="/active/index.html?autofill=ifyouseethisitisworkingnow" target="_blank" style="font-size:13px;">Right Here</a> to register the SW and then come back to the page</li>
        <p>IF THAT DOESN'T WORK:</p>
        <li>2nd method: Clear your cookies (chrome://settings/content/all?searchSubpage=[jmw link]) and press the trashcan icon</li>
      </ul>
    </center>
  </div>
  <button id="alertHide" style="display:block;margin:20px auto 0 auto;padding:10px 20px;border:none;background:#333;color:#fff;border-radius:10px;cursor:pointer;">Do not show again</button>
</div>

  <nav>
    <div id="tabs"></div>
    <button id="new-tab-btn" aria-label="New Tab" title="New Tab">

      <i class='bx bx-plus'></i>
    </button>
  </nav>

  <form id="form" align="center">
    <a href="#" id="fullscreen-icon" class="fc nav-btn" onclick="historyBack();"><i class='bx bx-chevron-left'></i></a>
    <a href="#" id="fullscreen-icon" class="fc nav-btn" onclick="historyForward();"><i class='bx bx-chevron-right'></i></a>
    <a href="#" id="fullscreen-icon" class="fc nav-btn" onclick="reload();"><i class="bx bx-refresh"></i></a>
    <input id="address" type="text" placeholder="Search privately.." class="search" autocomplete="off" />
    <a href="#" id="fullscreen-icon" class="fc" onclick="full();"><i class="bx bx-fullscreen"></i></a>
  </form>
  <section id="frames"></section>
  <script async defer>
    function full() {
      let elem = document.querySelector('iframe')
      if (!document.fullscreenElement) {
        elem.requestFullscreen().catch(err => {
          alert(`Error attempting to enable fullscreen mode: ${err.message} (${err.name})`)
        })
      } else {
        document.exitFullscreen()
      }
    }
  </script>
</body>
<script src="/assets/scripts/index.js"></script>
<script>
function reload() {
  var iframe = document.querySelector("iframe");
  iframe.contentWindow.location.reload();
}
function historyBack() {
  var iframe = document.querySelector("iframe");
  iframe.contentWindow.history.back();
}
function historyForward() {
  var iframe = document.querySelector("iframe");
  iframe.contentWindow.history.forward();
}
</script>
<script>
(function(){
  if(localStorage.getItem("hideCustomAlert")==="true") return
  var alertBox=document.getElementById("customAlert")
  var closeBtn=document.getElementById("alertClose")
  var hideBtn=document.getElementById("alertHide")
  alertBox.style.display="block"
  closeBtn.addEventListener("click",function(){alertBox.style.display="none"})
  hideBtn.addEventListener("click",function(){
    localStorage.setItem("hideCustomAlert","true")
    alertBox.style.display="none"
  })
})();
</script>
</html>